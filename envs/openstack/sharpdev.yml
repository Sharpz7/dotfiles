# https://github.com/Sharpz7/dotfiles/blob/main/envs/openstack/sharpdev.yml

version: 1

# envfile: env/.env

# https://docs.opendev.org/opendev/infra-manual/latest/sandbox.html
# https://docs.opendev.org/opendev/infra-manual/latest/developers.html

scripts:
  key: |
    if [ ! -f ~/.ssh/id_rsa ]; then
      touch ~/.ssh/id_rsa
      chmod 600 ~/.ssh/id_rsa
      nano ~/.ssh/id_rsa
    fi

    # if file does not exist (sh)
    if [ ! -f ~/.ssh/config ]; then
      touch ~/.ssh/config
      echo "Host review.opendev.org" >> ~/.ssh/config
      echo "  ForwardAgent yes" >> ~/.ssh/config
    fi

  setup: |
    git config core.editor "vscode"
    sudo apt install -y git-review

    echo "*" > ./env/.gitignore
    git config --global --add gitreview.username "adamcarthur"
    git review -s

    # set git config to be merges instead of preserve

  git-init: |
    eval `ssh-agent`

  # git clone https://opendev.org/opendev/sandbox
  test: |
    git checkout -b testing
    echo "# Hello World" > adam.md
    git add .
    git commit -m "Initial commit from Adam"
    git review -R

    # For Topic
    # git review -R -t testing

  git_config: |
    git config --list --show-origin

  commit: |
    git add .
    git commit -s -m $_ARG1

  latest: |
    git remote update
    git checkout master
    git pull --ff-only origin master

  squash: |
    git checkout master
    git pull origin master
    git checkout TOPIC-BRANCH
    git rebase -i master